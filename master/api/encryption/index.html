<!--
 -- Copyright 2021 IBM Corp.
 -- SPDX-License-Identifier: Apache-2.0
 -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Extensible Data Skipping Framework for Apache Spark">
      
      
        <meta name="author" content="Xskipper team">
      
      
        <link rel="canonical" href="https://xskipper.io/master/api/encryption/">
      
      
        <link rel="prev" href="../indexing/">
      
      
        <link rel="next" href="../creating-new-plugin/">
      
      
      <link rel="icon" href="../../img/logo_black.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Index Encryption - Xskipper</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#encrypting-indexes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Xskipper" class="md-header__button md-logo" aria-label="Xskipper" data-md-component="logo">
      
  <img src="../../img/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Xskipper
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Index Encryption
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/xskipper-io/xskipper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xskipper-io/xskipper
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/quick-start-guide/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../concepts/data-skipping/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../indexing/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://github.com/xskipper-io/xskipper/releases" class="md-tabs__link">
        
  
    
  
  Releases

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Xskipper" class="md-nav__button md-logo" aria-label="Xskipper" data-md-component="logo">
      
  <img src="../../img/logo_white.png" alt="logo">

    </a>
    Xskipper
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xskipper-io/xskipper" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    xskipper-io/xskipper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-start-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/sample-notebooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Demo Notebooks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/data-skipping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Skipping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/extensible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extensible Data Skipping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/indexing-flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indexing Flow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/query-evaluation-flow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query Evaluation Flow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../indexing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Indexing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Index Encryption
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Index Encryption
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modularity" class="md-nav__link">
    <span class="md-ellipsis">
      Modularity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modularity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-choose-keys" class="md-nav__link">
    <span class="md-ellipsis">
      How to choose keys
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Usage Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Usage Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-creation-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Index Creation Flow
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Index Creation Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sample-1-creating-metadata-with-encrypted-footer-default" class="md-nav__link">
    <span class="md-ellipsis">
      Sample 1 - Creating metadata with encrypted footer (default)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sample-2-creating-metadata-with-plaintext-footer" class="md-nav__link">
    <span class="md-ellipsis">
      Sample 2 - creating metadata with plaintext footer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Query Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#index-refresh-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Index Refresh Flow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../creating-new-plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using The Extensible API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xskipper Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/parquet-mdstore-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parquet Metadatastore Configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/parquet-metadatastore-spec/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parquet metadatastore spec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/metadata-versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadata versioning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../developer/generate-doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Doc Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/xskipper-io/xskipper/blob/master/CONTRIBUTING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/xskipper-io/xskipper/releases" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<!--
 -- Copyright 2021 IBM Corp.
 -- SPDX-License-Identifier: Apache-2.0
 -->

<h1 id="encrypting-indexes">Encrypting Indexes<a class="headerlink" href="#encrypting-indexes" title="Permanent link">&para;</a></h1>
<p>When using Parquet Metadata Store, The metadata can
optionally be encrypted using Parquet Modular Encryption (PME).
This is achieved since the metadata itself is stored as a Parquet dataset,
and thus PME can be used to encrypt it.
This feature applies to all input formats, for example, a dataset stored
in CSV format can have its metadata encrypted using PME.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the following sections, unless said otherwise, when referring
to footers, columns etc., these are with respect to the metadata objects,
and not the objects in the indexed dataset.</p>
</div>
<h2 id="modularity">Modularity<a class="headerlink" href="#modularity" title="Permanent link">&para;</a></h2>
<p>Index Encryption is modular and is granular in the following way:</p>
<ul>
<li>Each Index can either be encrypted (with a per-index key granularity) or left plaintext.</li>
<li>Footer + object name column + partition key values:<ul>
<li>The footer of the metadata object (in itself a Parquet file) contains (among other things):<ul>
<li>Schema of the metadata object, which reveals the types, parameters and column names for
all indexes collected (for example, one can learn that a Bloom Filter Index is defined on column
<code>city</code> with false-positive probability <code>0.1</code>)</li>
<li>Full path of the original dataset (or table name in case of a Hive Metastore table)</li>
</ul>
</li>
<li>The object name column stores the names of all indexed objects, and their
  modification timestamps at indexing time.</li>
<li>The partition key values (for example, when Hive Style partitioning is used in the indexed dataset)
  are automatically stored by Xskipper, each virtual column in its own dedicated column.</li>
</ul>
</li>
</ul>
<p>The footer + object name column + partition columns are encrypted using the same key - the "footer key",
unless Plaintext footer is specified, in that case the object name column and the partition
columns will still be encrypted, but the footer itself will be left plaintext (that is,
the plaintext footer mode of PME will be activated).
If at least 1 index is encrypted then the footer key must be set.</p>
<p>This granularity enables usecases where different users have access to different subsets of the indexes in the metadata.
In general, Xskipper will only try to access the indexes relevant for the query (based on the predicates in the <code>WHERE</code>  clause) - and thus
it's enough to only have access to the footer key and the keys for the relevant indexes.
Thus, with an appropriate key selection, a single copy of the metadata can be used by different users, with each user having the keys for the indexes
relevant to the columns they have access to in the data.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Xskipper doesn't have a fallback mechanism for index access, so even if the user has access to a subset of the indexes
that is able to provide some skipping, if there are usable indexes for the query which are unaccessible - Xskipper will not be able to provide
any skipping, the query will succeed but no skipping will happen - for example,
say we have a <code>MinMax</code> on <code>temp</code> and <code>ValueList</code> on <code>city</code> but we can only access the footer key + the key 
for the <code>MinMax</code> and we run a query with <code>WHERE city = 'PARIS' AND temp &lt; 5</code> - even though we could use just the <code>MinMax</code>
to get some skipping (though probably not all) - no skipping will occur.</p>
</div>
<h3 id="how-to-choose-keys">How to choose keys<a class="headerlink" href="#how-to-choose-keys" title="Permanent link">&para;</a></h3>
<p>As mentioned before, if an index is not required for a query, Xskipper won't try to access it,
and so the only factor for whether Xskipper tries to access an index is whether it's required for a query - and NOT whether it's accessible.
thus, a good practice would be to make sure that if someone has access to a column, they will also have access to the indexes defined for that column (and of course the footer).</p>
<h2 id="usage-flow">Usage Flow<a class="headerlink" href="#usage-flow" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>When using index encryption, whenever a "key" is configured in any Xskipper API,
it's always the label - <strong>NEVER</strong> the key itself.</p>
</div>
<p>In the following code examples we omit the PME configuration part as it varies between different implementations.
A demonstrational KMS example can be found <a href="https://spark.apache.org/docs/latest/sql-data-sources-parquet.html#columnar-encryption">here</a></p>
<h3 id="index-creation-flow">Index Creation Flow<a class="headerlink" href="#index-creation-flow" title="Permanent link">&para;</a></h3>
<p><center>
<img alt="Encrypted Index Creation Flow" src="../../img/encryption_index_creation_flow.svg" />
</center></p>
<p>Once the metadata is created, subsequent usages (both querying and refreshing) are 
all agnostic to the fact that this metadata is encrypted - so, except for the regular
PME configurations (KMS, auth etc.) - everything remains the same.</p>
<h4 id="sample-1-creating-metadata-with-encrypted-footer-default">Sample 1 - Creating metadata with encrypted footer (default)<a class="headerlink" href="#sample-1-creating-metadata-with-encrypted-footer-default" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Python</label><label for="__tabbed_1_2">Scala</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># configure footer key</span>
<span class="n">conf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;io.xskipper.parquet.encryption.footer.key&quot;</span><span class="p">,</span> <span class="s2">&quot;k1&quot;</span><span class="p">)])</span>
<span class="n">xskipper</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="c1"># adding the indexes</span>
<span class="n">xskipper</span><span class="o">.</span><span class="n">indexBuilder</span><span class="p">()</span> \
<span class="o">.</span><span class="n">addMinMaxIndex</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;k2&quot;</span><span class="p">)</span> \
<span class="o">.</span><span class="n">addValueListIndex</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">)</span> \
<span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> \
<span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// set the footer key</span>
<span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span>
<span class="w">  </span><span class="s">&quot;io.xskipper.parquet.encryption.footer.key&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;k1&quot;</span><span class="p">)</span>
<span class="n">xskipper</span><span class="p">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">xskipper</span>
<span class="w">  </span><span class="p">.</span><span class="n">indexBuilder</span><span class="p">()</span>
<span class="w">  </span><span class="c1">// Add an encrypted MinMax index for temp</span>
<span class="w">  </span><span class="p">.</span><span class="n">addMinMaxIndex</span><span class="p">(</span><span class="s">&quot;temp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k2&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// Add a plaintext ValueList index for city</span>
<span class="w">  </span><span class="p">.</span><span class="n">addValueListIndex</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">reader</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<h4 id="sample-2-creating-metadata-with-plaintext-footer">Sample 2 - creating metadata with plaintext footer<a class="headerlink" href="#sample-2-creating-metadata-with-plaintext-footer" title="Permanent link">&para;</a></h4>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Python</label><label for="__tabbed_2_2">Scala</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># configure footer key</span>
<span class="n">conf</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s2">&quot;io.xskipper.parquet.encryption.footer.key&quot;</span><span class="p">,</span> <span class="s2">&quot;k1&quot;</span><span class="p">),</span>
<span class="p">(</span><span class="s2">&quot;io.xskipper.parquet.encryption.plaintext.footer&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)])</span>
<span class="n">xskipper</span><span class="o">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="c1"># adding the indexes</span>
<span class="n">xskipper</span><span class="o">.</span><span class="n">indexBuilder</span><span class="p">()</span> \
<span class="o">.</span><span class="n">addMinMaxIndex</span><span class="p">(</span><span class="s2">&quot;temp&quot;</span><span class="p">,</span> <span class="s2">&quot;k2&quot;</span><span class="p">)</span> \
<span class="o">.</span><span class="n">addValueListIndex</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">)</span> \
<span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> \
<span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1">// set the footer key</span>
<span class="kd">val</span><span class="w"> </span><span class="n">conf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span>
<span class="s">&quot;io.xskipper.parquet.encryption.footer.key&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;k1&quot;</span><span class="p">,</span>
<span class="s">&quot;io.xskipper.parquet.encryption.plaintext.footer&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
<span class="n">xskipper</span><span class="p">.</span><span class="n">setConf</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">xskipper</span>
<span class="p">.</span><span class="n">indexBuilder</span><span class="p">()</span>
<span class="c1">// Add an encrypted MinMax index for temp</span>
<span class="p">.</span><span class="n">addMinMaxIndex</span><span class="p">(</span><span class="s">&quot;temp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;k2&quot;</span><span class="p">)</span>
<span class="c1">// Add a plaintext ValueList index for city</span>
<span class="p">.</span><span class="n">addValueListIndex</span><span class="p">(</span><span class="s">&quot;city&quot;</span><span class="p">)</span>
<span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">reader</span><span class="p">).</span><span class="n">show</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="query-flow">Query Flow<a class="headerlink" href="#query-flow" title="Permanent link">&para;</a></h3>
<p>When running Queries, there is no practical difference between encrypted metadata and non-encrypted metadata.
The only addition is the need to configure PME.
<center>
<img alt="Encrypted Index Query Flow" src="../../img/encryption_query_flow.svg" />
</center></p>
<h3 id="index-refresh-flow">Index Refresh Flow<a class="headerlink" href="#index-refresh-flow" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When refreshing encrypted metadata, ALL keys used in the metadata (that is, keys to all indexes + footer key) need to be accessible.</p>
</div>
<p>When refreshing encrypted metadata, no action is required except for PME configurations (KMS, auth etc.)
<center>
<img alt="Encrypted Index Refresh Flow" src="../../img/encryption_refresh_flow.svg" />
</center></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      @ 2020 Xskipper.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/xskipper-io" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "toc.integrate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>